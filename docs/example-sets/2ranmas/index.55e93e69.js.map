{"mappings":"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","sources":["javascript/fkissAction.mjs","javascript/fkissEvent.mjs","javascript/kissCel.mjs","javascript/kissSound.mjs","javascript/kissObject.mjs","javascript/logger.mjs","javascript/kissDoll.mjs","javascript/dragAndDrop.mjs","javascript/doll.js"],"sourcesContent":["function makeAction (a, doll) {\n  const actionMap = {\n    altmap: mkAltmap,\n    changeset: mkChangeset,\n    map: mkMap,\n    move: mkMove,\n    nop: mkNop,\n    sound: mkSound,\n    transparent: mkTransparent,\n    timer: mkTimer,\n    unmap: mkUnmap\n    /*\n    Not implemented:\n    changecol\n    shell\n    viewport\n    windowsize\n    */\n  }\n\n  const mkAction = actionMap[a.action]\n\n  if (mkAction) {\n    return mkAction(a.args, doll)\n  }\n  doll.logger.warn(`Unknown action \"${a.action}\"`)\n}\n\nfunction mkAltmap (args, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  if (objOrCel) {\n    return objOrCel.altmap.bind(objOrCel)\n  }\n}\n\nfunction mkChangeset (args, doll) {\n  return doll.changeSet.bind(doll, args[0])\n}\n\nfunction mkMap (args, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  if (objOrCel) {\n    return objOrCel.map.bind(objOrCel)\n  }\n}\n\nfunction mkMove (args, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  if (objOrCel) {\n    const dx = args[1]\n    const dy = args[2]\n    return objOrCel.move.bind(objOrCel, dx, dy)\n  }\n}\n\nfunction mkNop (args, doll) {\n  return () => doll.logger.debug('Nothing happened :)')\n}\n\nfunction mkSound (args, doll) {\n  const filename = args[0]\n  const sound = doll.getOrCreateSound(filename)\n  return sound.play.bind(sound)\n}\n\nfunction mkTimer (args, doll) {\n  const alarmId = args[0]\n  const duration = args[1]\n  return doll.setTimer.bind(doll, alarmId, duration)\n}\n\nfunction mkTransparent (args, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  if (objOrCel) {\n    const transparency = args[1]\n    return objOrCel.setTransparency.bind(objOrCel, transparency)\n  }\n}\n\nfunction mkUnmap (args, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  if (objOrCel) {\n    return objOrCel.unmap.bind(objOrCel)\n  }\n}\n\nfunction objOrCelArg (arg, doll) {\n  if (typeof arg === 'number') {\n    const obj = doll.getObject(arg)\n    if (obj) {\n      return obj\n    } else {\n      doll.logger.warn(`Unable to find object with mark \"#${arg}\"`)\n    }\n  }\n  if (arg.endsWith('.cel')) {\n    const cel = doll.getCel(arg)\n    if (cel) {\n      return cel\n    } else {\n      doll.logger.warn(`Unable to find cel with filename \"${arg}\"`)\n    }\n  }\n  doll.logger.error(`Expected a cel or object reference but got \"${arg}\"`)\n}\n\nexport { makeAction, objOrCelArg }\n","import { makeAction, objOrCelArg } from './fkissAction.mjs'\n\nfunction addEvent (eventJson, doll) {\n  const setEvent = eventMap[eventJson.event]\n\n  if (setEvent) {\n    const actions = eventJson.actions.map(a => makeAction(a, doll)).filter(e => e !== undefined)\n    setEvent(eventJson.args, actions, doll)\n  } else {\n    doll.logger.warn(`Unknown event \"${eventJson.event}\"`)\n  }\n}\n\nconst eventMap = {\n  alarm: setAlarm,\n  begin: setBegin,\n  catch: setCatch,\n  col: setCol,\n  drop: setDrop,\n  end: setEnd,\n  fixcatch: setFixcatch,\n  fixdrop: setFixdrop,\n  initialize: setInitialize,\n  never: setNever,\n  press: setPress,\n  release: setRelease,\n  set: setSet,\n  unfix: setUnfix\n}\n\n// Notes on each event are from Tigger's FKiSS reference: http://tigger.orpheusweb.co.uk/KISS/fkref4.html\n\n// A timer reaches zero.\nfunction setAlarm (args, actions, doll) {\n  const index = args[0]\n  doll.timers[index] = {\n    timeout: false,\n    callback: () => {\n      actions.forEach(f => f())\n\n      doll.update()\n      doll.draw()\n    }\n  }\n}\n\n// This event is triggered after the initialize event and before the version event.\nfunction setBegin (args, actions, doll) {\n  doll.addEventListener('begin', (e) => actions.forEach(f => f()))\n}\n\n// The user clicks on the object or cel. Applies to all cels & objects except those with a maximal fix value.\nfunction setCatch (args, actions, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  objOrCel.addEventListener('catch', (e) => actions.forEach(f => f()))\n}\n\n// The user changes the palette to that specified\nfunction setCol (args, actions, doll) {\n  doll.logger.warn(\"Not implemented: `col`. Smooch doesn't implement palette groups.\")\n}\n\n// The user releases the mouse on the object or cel. Applies to all cels & objects except those with a maximal fix value.\nfunction setDrop (args, actions, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  objOrCel.addEventListener('drop', (e) => actions.forEach(f => f()))\n}\n\n// The user quits the player or closes the doll\nfunction setEnd (args, actions, doll) {\n  doll.logger.warn('Not implemented: `end`. The browser environment makes this event impractical.')\n}\n\n// The user clicks on the object or cel. Applies only to fixed cels & objects\nfunction setFixcatch (args, actions, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  objOrCel.addEventListener('fixcatch', (e) => actions.forEach(f => f()))\n}\n\n// The user releases the mouse on the object or cel. Applies only to fixed cels & objects\nfunction setFixdrop (args, actions, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  objOrCel.addEventListener('fixdrop', (e) => actions.forEach(f => f()))\n}\n\n// Before the doll is displayed after loading\nfunction setInitialize (args, actions, doll) {\n  doll.addEventListener('initialize', (e) => actions.forEach(f => f()))\n}\n\n// This event is never triggered. Intended for debugging purposes during doll development.\nfunction setNever () {\n  // nothing happens :)\n}\n\n// The user clicks on the object or cel.\nfunction setPress (args, actions, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  if (objOrCel) {\n    objOrCel.addEventListener('press', (e) => actions.forEach(f => {\n      if (f) { f() }\n\n      doll.update()\n      doll.draw()\n    }))\n  }\n}\n\n// The user releases the object or cel.\nfunction setRelease (args, actions, doll) {\n  const objOrCel = objOrCelArg(args[0], doll)\n  objOrCel.addEventListener('release', (e) => actions.forEach(f => f()))\n}\n\n// The user changes the specified set\nfunction setSet (args, actions, doll) {\n  const set = args[0]\n  doll.addEventListener(`set-${set}`, (e) => actions.forEach(f => f()))\n}\n\n// A previously-fixed cel or object becomes free to move.\nfunction setUnfix (args, actions, doll) {\n  doll.logger.warn(\"Not implemented: `unfix`. Smooch doesn't (currently) decrement fix.\")\n}\n\nexport { addEvent }\n","// A KiSS Cel represents each instance of an image appearing in the\n// doll. It doesn't represent the image file itself. So a single\n// image can appear multiple times in multiple objects as different\n// KiSSCels\nclass KiSSCel extends EventTarget {\n  constructor (obj, cel, index) {\n    super()\n\n    this.name = cel.name\n    this.mark = cel.mark\n    this.id = cel.name\n    this.index = index\n    this.fix = cel.fix\n    this.position = obj.positions[0]\n    this.positions = obj.positions\n    this.sets = cel.sets\n    this.palette = cel.palette\n    this.image = false\n    this.ghostImage = undefined\n    this.visible = false\n    this.mapped = true\n    this.alpha = cel.alpha\n    this.currentSet = 0\n    this.offset = cel.offset\n\n    return this\n  }\n\n  loadImage (doll, incLoaded) {\n    const drawctxt = doll.ctxt\n    const drawcanvas = doll.canvas\n    const pngLocation = `${doll.staticDirectory}/palette${this.palette}/${this.name}.png`\n    const cel = this\n\n    const image = new Image()\n    image.addEventListener('load', e => {\n      // Draw image to ctxt and get image data\n      drawctxt.drawImage(image, 0, 0, image.width, image.height)\n\n      const ghostImageData = drawctxt.getImageData(0, 0, image.width, image.height)\n      const data = ghostImageData.data\n\n      // Fill ghost image data with cel color\n      const color = decimalToRgb(cel.index)\n      for (let k = 0; k < data.length; k = k + 4) {\n        data[k] = color.red\n        data[k + 1] = color.green\n        data[k + 2] = color.blue\n      }\n\n      // Clear ctxt and draw altered image\n      drawctxt.clearRect(0, 0, doll.size.x, doll.size.y)\n      drawctxt.putImageData(ghostImageData, 0, 0)\n\n      // Save altered image as cel's ghost image\n      cel.ghostImage = new Image()\n      cel.ghostImage.src = drawcanvas.toDataURL('image/png')\n\n      // Let Smooch know when image is loaded\n      cel.ghostImage.addEventListener('load', e => {\n        incLoaded()\n      })\n\n      cel.image = image\n    })\n\n    image.src = pngLocation\n  }\n\n  update (currentSet) {\n    this.currentSet = currentSet\n    if (this.sets.indexOf(currentSet) === -1 || !this.mapped) {\n      this.visible = false\n    } else {\n      this.visible = true\n    }\n    this.position = this.positions[currentSet]\n  }\n\n  draw (screen, ghost) {\n    if (!this.image) return false\n\n    if (this.visible === true) {\n      if (this.alpha) {\n        screen.globalAlpha = (255 - this.alpha) / 255\n      }\n\n      screen.drawImage(\n        this.image,\n        this.position.x + this.offset.x,\n        this.position.y + this.offset.y\n      )\n\n      screen.globalAlpha = 1\n\n      ghost.drawImage(\n        this.ghostImage,\n        this.position.x + this.offset.x,\n        this.position.y + this.offset.y\n      )\n    }\n  }\n\n  altmap () {\n    this.mapped = !this.mapped\n  }\n\n  map () {\n    this.mapped = true\n  }\n\n  move (dx, dy) {\n    this.positions[this.currentSet].x += dx\n    this.positions[this.currentSet].y += dy\n  }\n\n  setTransparency (alpha) {\n    this.alpha = alpha\n  }\n\n  unmap () {\n    this.mapped = false\n  }\n}\n\n// thanks to DrBracewell#0252 on The Coding Den Discord\nfunction decimalToRgb (n) {\n  return {\n    red: (n & 0xff0000) >> 16,\n    green: (n & 0x00ff00) >> 8,\n    blue: (n & 0x0000ff)\n  }\n}\n\nexport { KiSSCel }\n","class KiSSSound {\n  constructor (staticDirectory, filename) {\n    // some early viewers supported au and others supported wav\n    // so early sets would ship with both\n    // we can only play wav, so if we get an au file, we try\n    // to find a wav version.\n    // This is just a hack until Smooch supports multiple CNFs\n    const wavFile = filename.replace('.au', '.wav')\n    const url = `${staticDirectory}/${wavFile}`\n    this.audio = new Audio(url)\n\n    return this\n  }\n\n  play () {\n    if (this.audio.HAVE_ENOUGH_DATA) {\n      return this.audio.play()\n    } else {\n      this.audio.addEventListener('canplaythrough', event => {\n        return this.audio.play()\n      })\n    }\n  }\n}\n\nexport { KiSSSound }\n","class KiSSObject extends EventTarget {\n  constructor (mark, positions) {\n    super()\n\n    this.mark = mark\n    this.id = mark\n    this.currentSet = 0\n    this.positions = positions\n    this.cels = []\n\n    return this\n  }\n\n  update (currentSet) {\n    this.currentSet = currentSet\n    for (let i = 0; i < this.cels.length; i++) {\n      this.cels[i].update(currentSet)\n    }\n  }\n\n  get position () {\n    return this.positions[this.currentSet]\n  }\n\n  get fixed () {\n    return this.cels.some(c => c.fix > 0)\n  }\n\n  setPosition (x, y) {\n    this.positions[this.currentSet].x = x\n    this.positions[this.currentSet].y = y\n  }\n\n  altmap () {\n    this.cels.forEach(cel => { cel.altmap() })\n  }\n\n  map () {\n    this.cels.forEach(cel => cel.map())\n  }\n\n  move (dx, dy) {\n    this.positions[this.currentSet].x += dx\n    this.positions[this.currentSet].y += dy\n  }\n\n  setTransparency (alpha) {\n    this.cels.forEach(cel => cel.setTransparency(alpha))\n  }\n\n  unmap () {\n    this.cels.forEach(cel => cel.unmap())\n  }\n}\n\nexport { KiSSObject }\n","class Logger {\n  constructor (logLevel) {\n    if (['debug', 'warning', 'error'].includes(logLevel)) {\n      this.logLevel = logLevel\n    } else {\n      this.logLevel = 'none'\n    }\n  }\n\n  debug (msg) {\n    if (this.logLevel !== 'none') {\n      console.log(msg)\n    }\n  }\n\n  warn (msg) {\n    if (this.logLevel !== 'none' && this.logLevel !== 'debug') {\n      console.log(msg)\n    }\n  }\n\n  error (msg) {\n    if (this.logLevel === 'error') {\n      console.log(msg)\n    }\n  }\n}\n\nexport { Logger }\n","import { addEvent } from './fkissEvent'\nimport { KiSSCel } from './kissCel.mjs'\nimport { KiSSSound } from './kissSound.mjs'\nimport { KiSSObject } from './kissObject.mjs'\nimport { Logger } from './logger'\n\nclass KiSSDoll extends EventTarget {\n  constructor (kissData, staticDirectory) {\n    super()\n\n    this.staticDirectory = staticDirectory\n    this.cnf = kissData\n    this.logger = new Logger('debug')\n\n    // Size of the play area.\n    this.size = { x: kissData.window_size[0], y: kissData.window_size[1] }\n\n    // Set colors\n    this.borderColor = kissData.border\n    this.backgroundColor = kissData.background\n\n    // Initialize current set\n    this.currentSet = 0\n\n    // Initialize objs and cels\n    this.objs = []\n    this.cels = []\n    this.sounds = []\n    this.timers = []\n\n    return this\n  }\n\n  initialize (incLoaded) {\n    // Set up border area (around the playarea)\n    const borderarea = document.getElementById('borderarea')\n    borderarea.style.background = this.borderColor\n\n    // Set up play area\n    const playarea = document.getElementById('playarea')\n    playarea.style.width = this.size.x + 'px'\n    playarea.style.height = this.size.y + 'px'\n    playarea.style.background = this.backgroundColor\n\n    // Set up canvases\n    this.initCanvases(this.size)\n\n    this.initCels(this.cnf.cels, this.cnf.positions)\n    initSetClicks(this)\n\n    if (this.cnf.fkiss) {\n      this.initFKiSS(this.cnf.fkiss)\n    }\n\n    this.dispatchEvent(new CustomEvent('initialize'))\n\n    // load images for all the cels\n    this.cels.forEach(c => c.loadImage(this, incLoaded))\n  }\n\n  begin () {\n    // Update and draw\n    this.update()\n    this.draw()\n\n    this.dispatchEvent(new CustomEvent('begin'))\n  }\n\n  initCels (cnfCels, cnfPositions, incLoaded) {\n    /* Cels have to be kept in a separate list from the objects.\n        This is because objects are the things that get dragged, change\n        position, etc. But cels are the things that are drawn, and they have\n        to be drawn in a certain order to get the right layering effect. */\n\n    cnfCels.reverse()\n\n    cnfCels.forEach((cnfCel, i) => {\n      // Objects are indexed by their \"mark\". This is what groups cels together.\n      // First check if there's already an object with that mark.\n      const existingObj = this.objs[cnfCel.mark]\n      if (existingObj) {\n        // If object already exists, create a cel that points to that object.\n        const newCel = new KiSSCel(existingObj, cnfCel, i)\n        // Add the new cel to the object's list of cels.\n        existingObj.cels.push(newCel)\n        // Add the new cel to the doll's list of cels.\n        this.cels.push(newCel)\n      } else {\n        // If the object doesn't already exist, we need to create it.\n\n        // Create the new object and new cel\n        const newObj = new KiSSObject(cnfCel.mark, cnfPositions.map(sp => sp.positions[cnfCel.mark] || { x: 0, y: 0 }))\n        const newCel = new KiSSCel(newObj, cnfCel, i)\n        // Add the new cel to the object's list of cels.\n        newObj.cels.push(newCel)\n        // Add the object to the doll's list of objects.\n        this.objs[cnfCel.mark] = newObj\n        // Add the cel to the doll's list of cels.\n        this.cels.push(newCel)\n      }\n    })\n  }\n\n  initCanvases (size) {\n    const drawcanvas = document.getElementById('screen')\n    setCanvasSize(drawcanvas, size)\n\n    const ghostcanvas = document.getElementById('ghost')\n    setCanvasSize(ghostcanvas, size)\n\n    this.canvas = drawcanvas\n    this.ctxt = drawcanvas.getContext('2d')\n    this.ghost = ghostcanvas.getContext('2d')\n\n    drawcanvas.addEventListener('touchstart', function (event) { event.preventDefault() })\n    drawcanvas.addEventListener('touchmove', function (event) { event.preventDefault() })\n    drawcanvas.addEventListener('touchend', function (event) { event.preventDefault() })\n    drawcanvas.addEventListener('touchcancel', function (event) { event.preventDefault() })\n  }\n\n  changeSet (newSet) {\n    this.update(newSet)\n    this.draw()\n    updateSets(this.currentSet)\n  }\n\n  getSelectedObject (pos) {\n    const pixel = this.ghost.getImageData(pos.x, pos.y, 1, 1)\n    const data = pixel.data\n    const index = rgbToDecimal(data[0], data[1], data[2])\n    const alpha = data[3]\n\n    if (alpha === 0) {\n      console.log('not draggable')\n      return false\n    } else {\n      const cel = this.cels[index]\n      const obj = this.objs[cel.mark]\n      return { object: obj, cel: cel }\n    }\n  }\n\n  getObjectPosition (obj) {\n    return obj.positions[this.currentSet]\n  }\n\n  getCel (celName) {\n    return this.cels.find(c => (c.name + '.cel') === celName)\n  }\n\n  getObject (objMark) {\n    return this.objs[objMark]\n  }\n\n  createSound (filename) {\n    this.sounds[filename] = new KiSSSound(filename)\n  }\n\n  getOrCreateSound (filename) {\n    const sound = this.sounds[filename]\n    if (sound) {\n      return sound\n    } else {\n      const newSound = new KiSSSound(this.staticDirectory, filename)\n      this.sounds[filename] = newSound\n      return newSound\n    }\n  }\n\n  setTimer (alarmId, duration) {\n    const timer = this.timers[alarmId]\n    const currentTimeout = timer ? timer.timeout : false\n    const currentCallback = timer ? timer.callback : () => {}\n    if (currentTimeout) {\n      clearTimeout(currentTimeout)\n    }\n    const timeout = setTimeout(() => {\n      this.timers[alarmId].timeout = false\n      this.timers[alarmId].callback()\n    }, duration)\n\n    this.timers[alarmId] = { timeout: timeout, callback: currentCallback }\n  }\n\n  moveObject (obj, x, y) {\n    obj.setPosition(x, y)\n\n    this.update()\n    this.draw()\n  }\n\n  initFKiSS (events) {\n    events.forEach(e => {\n      addEvent(e, this)\n    })\n  }\n\n  update (newSet) {\n    // Update current set if new set is given\n    if (typeof newSet !== 'undefined') { this.currentSet = newSet }\n\n    // Update cels\n    for (let i = 0; i < this.objs.length; i++) {\n      // have to check if object exists first, because we are using\n      // the object id (\"mark\") as the index for the array, so\n      // many indexes are skipped.\n      if (this.objs[i]) {\n        this.objs[i].update(this.currentSet)\n      }\n    }\n  }\n\n  draw () {\n    this.ctxt.clearRect(0, 0, this.size.x, this.size.y)\n    this.ghost.clearRect(0, 0, this.size.x, this.size.y)\n    this.cels.forEach(cel => cel.draw(this.ctxt, this.ghost))\n  }\n}\n\nfunction initSetClicks (doll) {\n  // Add click events to set numbers\n  const sets = document.getElementsByClassName('set')\n  for (let i = 0; i < sets.length; i++) {\n    // when a number is clicked, update doll to new set\n    sets[i].addEventListener('click', function () {\n      const newSet = parseInt(this.innerHTML)\n      doll.changeSet(newSet)\n    })\n  }\n\n  const tip = document.getElementsByClassName('tip')[0]\n  const openTip = document.getElementById('open-tip')\n  openTip.addEventListener('click', e => {\n    tip.style.display = 'block'\n  })\n  const closeTip = document.getElementById('close-tip')\n  closeTip.addEventListener('click', e => {\n    tip.style.display = 'none'\n  })\n}\n\nfunction updateSets (currentSet) {\n  // Update set listing to highlight current set\n  const sets = document.getElementsByClassName('set')\n  for (let i = 0; i < sets.length; i++) {\n    if (currentSet === parseInt(sets[i].innerHTML)) {\n      sets[i].style.color = 'black'\n    } else {\n      sets[i].style.color = 'grey'\n    }\n  }\n}\n\nfunction setCanvasSize (canvas, size) {\n  canvas.style.width = size.x + 'px'\n  canvas.style.height = size.y + 'px'\n  canvas.width = size.x\n  canvas.height = size.y\n}\n\nfunction rgbToDecimal (r, g, b) {\n  return (r << 16) + (g << 8) + b\n}\n\nexport { KiSSDoll }\n","class DragAndDrop {\n  constructor (doll) {\n    this.dragHandler = false\n    this.doll = doll\n    this.screen = document.getElementById('screen')\n    const canvas = document.getElementById('ghost')\n    this.ctxt = canvas.getContext('2d')\n  }\n\n  initialize () {\n    document.addEventListener('pointerdown', (e) => this.onMouseDown(e))\n    document.addEventListener('pointerup', () => {\n      if (this.dragHandler) {\n        document.removeEventListener('pointermove', this.dragHandler)\n        this.dragHandler = false\n      }\n    })\n  }\n\n  onMouseDown (e) {\n    const pos = this.getMousePos(e)\n    const objAndCel = this.doll.getSelectedObject(pos)\n    if (objAndCel) {\n      objAndCel.object.dispatchEvent(press)\n      objAndCel.cel.dispatchEvent(press)\n      if (!objAndCel.object.fixed) {\n        const dragStart = this.getDragStart(objAndCel.object, pos)\n        this.dragHandler = (e) => this.onMouseMove(e, objAndCel.object, dragStart)\n        document.addEventListener('pointermove', this.dragHandler)\n        e.preventDefault()\n      }\n    }\n  }\n\n  getDragStart (obj, pos) {\n    const objectPosition = this.doll.getObjectPosition(obj)\n    return {\n      x: objectPosition.x - pos.x,\n      y: objectPosition.y - pos.y\n    }\n  }\n\n  onMouseMove (e, obj, dragStart) {\n    const currentMousePosition = this.getMousePos(e)\n    const x = dragStart.x + currentMousePosition.x\n    const y = dragStart.y + currentMousePosition.y\n\n    this.doll.moveObject(obj, x, y)\n\n    e.preventDefault()\n  }\n\n  // from http://www.html5canvastutorials.com/advanced/html5-canvas-mouse-coordinates/\n  getMousePos (evt) {\n    const rect = this.screen.getBoundingClientRect()\n    return {\n      x: evt.clientX - rect.left,\n      y: evt.clientY - rect.top\n    }\n  }\n}\n\nconst press = new CustomEvent('press')\n\nexport { DragAndDrop }\n","import { KiSSDoll } from './kissDoll.mjs'\nimport { DragAndDrop } from './dragAndDrop.mjs'\n\nwindow.addEventListener('load', function () {\n  /* globals globalKiss */\n  let doll = false\n  let loaded = 0\n\n  const staticDir = document.getElementById('set-data').dataset.staticDirectory\n\n  fetch(`${staticDir}/setdata.json`).then(resp => {\n    return resp.json()\n  }).then(kissJson => {\n    const totalCels = kissJson.cels.length\n\n    function checkLoaded () {\n      console.log(`loading ${loaded} of ${totalCels}`)\n      if (loaded < totalCels) {\n        window.setTimeout(checkLoaded, 500)\n      } else {\n        doll.begin()\n        document.getElementById('loading').style.display = 'none'\n        document.getElementById('sets').style.display = 'block'\n        document.getElementById('borderarea').style.display = 'block'\n      }\n    }\n\n    window.setTimeout(checkLoaded, 500)\n\n    doll = new KiSSDoll(kissJson, staticDir)\n    const dragger = new DragAndDrop(doll)\n    doll.initialize(() => { loaded += 1 })\n    dragger.initialize()\n\n    // in testing and development, it's convenient to have access to\n    // to the kiss set object in the development console\n    if (typeof globalKiss !== 'undefined') {\n      // eslint-disable-next-line no-global-assign\n      globalKiss = doll\n    }\n  })\n})\n"],"names":["$75ac861633918555$var$mkAltmap","args","doll","objOrCel","$75ac861633918555$export$febf76ff2fd5620a","altmap","bind","$75ac861633918555$var$mkChangeset","changeSet","$75ac861633918555$var$mkMap","map","$75ac861633918555$var$mkMove","dx","dy","move","$75ac861633918555$var$mkNop","logger","debug","$75ac861633918555$var$mkSound","filename","sound","getOrCreateSound","play","$75ac861633918555$var$mkTimer","alarmId","duration","setTimer","$75ac861633918555$var$mkTransparent","transparency","setTransparency","$75ac861633918555$var$mkUnmap","unmap","arg","obj","getObject","warn","endsWith","cel","getCel","error","$ff81af2b2637e408$export$f531f92e2a15358f","eventJson","setEvent","$ff81af2b2637e408$var$eventMap","event","actions","a","mkAction","changeset","nop","transparent","timer","action","$75ac861633918555$export$d41d8024b2c8bb62","filter","e","undefined","alarm","index","timers","timeout","callback","forEach","f","update","draw","begin","addEventListener","catch","col","drop","end","fixcatch","fixdrop","initialize","never","press","release","set","unfix","$cb4732e3a2dda145$export$fc4b60b88d5c7598","EventTarget","super","this","name","mark","id","fix","position","positions","sets","palette","image","ghostImage","visible","mapped","alpha","currentSet","offset","loadImage","incLoaded","drawctxt","ctxt","drawcanvas","canvas","pngLocation","staticDirectory","Image","drawImage","width","height","ghostImageData","getImageData","data","color","red","n","green","blue","k","length","clearRect","size","x","y","putImageData","src","toDataURL","indexOf","screen","ghost","globalAlpha","$a3b0b7bb2e56dae3$export$7c02e49afbae163c","url","replace","audio","Audio","HAVE_ENOUGH_DATA","$4ff9e2e320aceacb$export$c76ef8c1aa23eb5b","cels","i","fixed","some","c","setPosition","$69283b35ceea83ab$export$efa9a398d6368992","logLevel","includes","msg","console","log","$562136bbb82eadf1$export$92944dc530d5048e","kissData","cnf","window_size","borderColor","border","backgroundColor","background","objs","sounds","document","getElementById","style","playarea","initCanvases","initCels","getElementsByClassName","newSet","parseInt","innerHTML","tip","display","$562136bbb82eadf1$var$initSetClicks","fkiss","initFKiSS","dispatchEvent","CustomEvent","cnfCels","cnfPositions","reverse","cnfCel","existingObj","newCel","push","newObj","sp","$562136bbb82eadf1$var$setCanvasSize","ghostcanvas","getContext","preventDefault","$562136bbb82eadf1$var$updateSets","getSelectedObject","pos","r","g","b","object","getObjectPosition","celName","find","objMark","createSound","newSound","currentTimeout","currentCallback","clearTimeout","setTimeout","moveObject","events","$77d75e8e41abf13e$export$a4c936d95bae1613","dragHandler","onMouseDown","removeEventListener","e1","getMousePos","objAndCel","$77d75e8e41abf13e$var$press","dragStart","getDragStart","onMouseMove","objectPosition","currentMousePosition","evt","rect","getBoundingClientRect","clientX","left","clientY","top","window","loaded","staticDir","dataset","fetch","then","resp","json","kissJson","totalCels","checkLoaded","dragger","globalKiss"],"version":3,"file":"index.55e93e69.js.map"}