# Contents

  * [Running this website on a local server](#local-server)
  * [JavaScript front-end](#javascript-front-end)
    * [doll.js](#dolljs)
    * [setdata.js](#setdatajs)

# Running this website on a local server

Due to [cross-origin resource sharing](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS), this website should be ran on a local server for proper testing in Chrome or Safari.  If index.html is opened directly, you may see an error like:
```
Uncaught DOMException: Failed to execute 'getImageData' on 'CanvasRenderingContext2D': The canvas has been tainted by cross-origin data.
```
Note that in Firefox this error may not occur.
Two possible servers to implement are Python Simple Server and Node-Http Server

## Python Simple Server (preferred for python or non-javascript users)
Follow the instructions at [this link](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/set_up_a_local_testing_server) for set up.

## Node-Http Server (preferred for javascript users)
First, [install node.js](https://nodejs.org/en/)

Then, follow the instructions at [this link](https://www.npmjs.com/package/http-server) for set up.

### Running the server
Change your directory from the project root to the docs folder
```
cd docs
```

Start up your local server using your preferred choice (python or node - follow the instructions in the appropriate link above)

Once server is running, navigate to the port in your browser (your port may be different depending on set up)
```
localhost:3000
```

# JavaScript front-end

The "front-end" of Smooch is just a few files. There's some HTML, a
CSS file, and two JavaScript files.

## doll.js

This is the JavaScript for the viewer. It's all vanilla JavaScript,
no libraries or anything.

### the ghost canvas

I'm using a game coding technique called a "ghost buffer" to detect
what images are being clicked on.

If you load a doll and right click and inspect the DOM, you'll see there's a
undisplayed second canvas besides the one that you can see and interact with.
That's the ghost canvas. If you remove the `display: none` from the CSS, you'll
be able to see it -- it's right below the actual canvas and has a bright blue
background. Each item in the real canvas is also drawn on the ghost canvas, but
in shades of black to red. Each item is a subtly different color.

When a player clicks on the real canvas, the JavaScript looks up the
corresponding pixel on the ghost canvas. Each color on the ghost canvas maps to
one object in the set, so the script knows which object you clicked!

## setdata.js

This is mostly JSON representing the KiSS doll set's configuration,
generated by Haskell side of the app. This script is just two variable
declarations.

### kissJson

Here's JSON for a set with one object:

```(json)
{
  // the size of the play area
  "window_size": [
    700,
    430
  ],
  "objs": [
  // an object has an id number, a list of cels, and a
  // list of positions
    {
      "id": 0,
      "cels": [
      // a cel has a palette for the cel, the sets the cel
      // is visible in, a "fix" value indicating how many
      // time you need to click the cel before you can
      // drag it (usually 0 for clothes, a large number for
      // the body), a name, and how transparent it should be.
        {
          "palette": 0,
          "sets": [
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
          ],
          "fix": 4000,
          "name": "aurora",
          "alpha": 0
        }
      ],
      "positions": [
        {
          "y": 0,
          "x": 0
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        },
        {
          "y": 67,
          "x": 283
        }
      ]
    }
  ]
}
```

### celJson

This is only the cel parts of the JSON.

```(json)
 {
 "palette": 0,
 "sets": [
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9
      ],
  "fix": 0,
  "name": "fuzzskir",
  "alpha": 0
  "offset": {
    "x": 0,
    "y": 0
    }
 }

```